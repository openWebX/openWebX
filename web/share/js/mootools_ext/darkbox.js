var Darkbox=new Class({Implements:[Events,Options],options:{falldown:false},initialize:function(a,b){this.setOptions(b);this.start($(a))},create_popup:function(){var b=new Element("div",{"class":"darkbox-frame"});var c=new Element("div",{"class":"darkbox-shadow"}).fade("hide").inject(b);var a=new Element("div",{"class":"darkbox-canvas"}).inject(c,"after");new Element("div",{"class":"darkbox-button"}).inject(a);return b},start:function(a){var b=this;a.getElements("a").each(function(c){c.addEvent("click",function(h){h.stop();if(!$$("div.darkbox-frame").length){darkbox=b.create_popup().inject(document.body)}var i=darkbox.clone().inject(document.body).addClass("darkbox-frame-on");var j=i.getElement("div.darkbox-shadow");j.set("tween",{duration:300}).fade(0.6);var d=i.getElement("div.darkbox-canvas");var f=i.getElement("div.darkbox-button");var g=new Element("img",{src:c.get("href"),alt:c.get("title")}).inject(d);g.addEvent("load",function(){var l=g.getWidth();var e=g.getHeight();var k=i.getWidth()-40;var m=i.getHeight()-40;if(l>k){l=k;g.setStyle("width",l+"px");while(g.getHeight()>m){g.setStyle("width",l+"px");l--}e=g.getHeight()}if(e>m){e=m;g.setStyle("height",e+"px");while(g.getWidth()>k){g.setStyle("height",e+"px");e--}l=g.getWidth()}var n=new Fx.Morph(d,{duration:500,transition:Fx.Transitions.Sine.easeOut,onComplete:function(){d.addClass("darkbox-canvas-done");f.addClass("darkbox-button-on");f.addClass(navigator.platform.toLowerCase().indexOf("mac")+1?"darkbox-button-left":"darkbox-button-right");g.fade("hide").set("tween",{duration:500,onComplete:function(){[j,f].each(function(p){p.addEvent("click",b.hide.bind(b,[d,j,i]))})}}).fade("in")}});d.addClass("darkbox-canvas-load");n.start({width:l,"margin-left":-l/2,height:e,"margin-top":-e/2})});document.addEvent("keydown",function(k){if(k.code==27){b.hide.run([d,j,i],b)}})})})},hide:function(a,c,b){if(!this.options.falldown){a.dispose();c.set("tween",{duration:300,onComplete:function(){b.dispose()}}).fade(0)}else{new Fx.Morph(a,{duration:500,transition:Fx.Transitions.Sine.easeInOut,onComplete:function(){b.dispose()}}).start({top:c.getHeight()*2})}}});